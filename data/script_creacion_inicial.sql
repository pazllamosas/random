USE [GD2C2016]
GO


-- DROP TABLAS 

IF OBJECT_ID('RANDOM.CANCELACION') IS NOT NULL
DROP TABLE RANDOM.CANCELACION
IF OBJECT_ID('RANDOM.TIPO_CANCELACION') IS NOT NULL
DROP TABLE RANDOM.TIPO_CANCELACION
IF OBJECT_ID('RANDOM.TURNO') IS NOT NULL
DROP TABLE RANDOM.TURNO
IF OBJECT_ID('RANDOM.RESULTADO_TURNO') IS NOT NULL
DROP TABLE RANDOM.RESULTADO_TURNO
IF OBJECT_ID('RANDOM.AGENDA_HORARIO_DISPONIBLE') IS NOT NULL
DROP TABLE RANDOM.AGENDA_HORARIO_DISPONIBLE
IF OBJECT_ID('RANDOM.DIA') IS NOT NULL
DROP TABLE RANDOM.DIA  
IF OBJECT_ID('RANDOM.BONO') IS NOT NULL
DROP TABLE RANDOM.BONO
IF OBJECT_ID('RANDOM.COMPRA_BONO') IS NOT NULL
DROP TABLE RANDOM.COMPRA_BONO
IF OBJECT_ID('RANDOM.ESPECIALIDAD_POR_PROFESIONAL') IS NOT NULL
DROP TABLE RANDOM.ESPECIALIDAD_POR_PROFESIONAL
IF OBJECT_ID('RANDOM.ESPECIALIDAD') IS NOT NULL
DROP TABLE RANDOM.ESPECIALIDAD
IF OBJECT_ID('RANDOM.TIPO_ESPECIALIDAD') IS NOT NULL
DROP TABLE RANDOM.TIPO_ESPECIALIDAD
IF OBJECT_ID('RANDOM.PROFESIONAL') IS NOT NULL
DROP TABLE RANDOM.PROFESIONAL
IF OBJECT_ID('RANDOM.HISTORIAL_PLAN') IS NOT NULL
DROP TABLE RANDOM.HISTORIAL_PLAN
IF OBJECT_ID('RANDOM.AFILIADO') IS NOT NULL
DROP TABLE RANDOM.AFILIADO
IF OBJECT_ID('RANDOM.PERSONA') IS NOT NULL
DROP TABLE RANDOM.PERSONA
IF OBJECT_ID('RANDOM.PLANES') IS NOT NULL
DROP TABLE RANDOM.PLANES
IF OBJECT_ID('RANDOM.ESTADO_CIVIL') IS NOT NULL
DROP TABLE RANDOM.ESTADO_CIVIL
IF OBJECT_ID('RANDOM.USUARIO_POR_ROL') IS NOT NULL
DROP TABLE RANDOM.USUARIO_POR_ROL
IF OBJECT_ID('RANDOM.USUARIO') IS NOT NULL
DROP TABLE RANDOM.USUARIO
IF OBJECT_ID('RANDOM.ROL_POR_FUNCIONALIDADES') IS NOT NULL
DROP TABLE RANDOM.ROL_POR_FUNCIONALIDADES
IF OBJECT_ID('RANDOM.FUNCIONALIDADES') IS NOT NULL
DROP TABLE RANDOM.FUNCIONALIDADES
IF OBJECT_ID('RANDOM.ROL') IS NOT NULL
DROP TABLE RANDOM.ROL

-- DROP PROCEDURES Y FUNCTIONS 

-- DROP TRIGGERS

-- DROP INDIXES

IF OBJECT_ID('A_FUNCIONALIDAD') IS NOT NULL
BEGIN
DROP index A_FUNCIONALIDAD ON RANDOM.ROL_POR_FUNCIONALIDADES ;
END;
GO

IF OBJECT_ID('A_ROL') IS NOT NULL
BEGIN
DROP index A_ROL ON RANDOM.ROL_POR_FUNCIONALIDADES ;
END;
GO

IF OBJECT_ID('UPR_USUARIO') IS NOT NULL
BEGIN
DROP index UPR_USUARIO ON RANDOM.USUARIO_POR_ROL ;
END;
GO

IF OBJECT_ID('UPR_ROL') IS NOT NULL
BEGIN
DROP index UPR_ROL ON RANDOM.USUARIO_POR_ROL ;
END;
GO

IF OBJECT_ID('A_PERSONA') IS NOT NULL
BEGIN
DROP index A_PERSONA ON RANDOM.AFILIADO ;
END;
GO

IF OBJECT_ID('A_ESTADO_CIVIL') IS NOT NULL
BEGIN
DROP index A_ESTADO_CIVIL ON RANDOM.AFILIADO ;
END;
GO

IF OBJECT_ID('A_PLAN') IS NOT NULL
BEGIN
DROP index A_PLAN ON RANDOM.AFILIADO ;
END;
GO

IF OBJECT_ID('HA_ID_AFILIADO') IS NOT NULL
BEGIN
DROP index HA_ID_AFILIADO ON RANDOM.HISTORIAL_PLAN ;
END;
GO

IF OBJECT_ID('P_PERSONA') IS NOT NULL
BEGIN
DROP index P_PERSONA ON RANDOM.PROFESIONAL ;
END;
GO

IF OBJECT_ID('E_TIPO_ESPECIALIDAD') IS NOT NULL
BEGIN
DROP index E_TIPO_ESPECIALIDAD ON RANDOM.ESPECIALIDAD ;
END;
GO

IF OBJECT_ID('EPP_PROFESIONAL') IS NOT NULL
BEGIN
DROP index EPP_PROFESIONAL ON RANDOM.ESPECIALIDAD_POR_PROFESIONAL ;
END;
GO

IF OBJECT_ID('EPP_ESPECIALIDAD') IS NOT NULL
BEGIN
DROP index EPP_ESPECIALIDAD ON RANDOM.ESPECIALIDAD_POR_PROFESIONAL ;
END;
GO

IF OBJECT_ID('CB_AFILIADO') IS NOT NULL
BEGIN
DROP index CB_AFILIADO ON RANDOM.COMPRA_BONO ;
END;
GO

IF OBJECT_ID('B_COMPRA') IS NOT NULL
BEGIN
DROP index B_COMPRA ON RANDOM.BONO ;
END;
GO

IF OBJECT_ID('HD_PROFESIONAL') IS NOT NULL
BEGIN
DROP index HD_PROFESIONAL ON RANDOM.AGENDA_HORARIO_DISPONIBLE ;
END;
GO

IF OBJECT_ID('HD_DIA') IS NOT NULL
BEGIN
DROP index HD_DIA ON RANDOM.AGENDA_HORARIO_DISPONIBLE ;
END;
GO

IF OBJECT_ID('HD_ESPECIALIDAD') IS NOT NULL
BEGIN
DROP index HD_ESPECIALIDAD ON RANDOM.AGENDA_HORARIO_DISPONIBLE ;
END;
GO

IF OBJECT_ID('T_AGENDA') IS NOT NULL
BEGIN
DROP index T_AGENDA ON RANDOM.TURNO ;
END;
GO

IF OBJECT_ID('T_BONO') IS NOT NULL
BEGIN
DROP index T_BONO ON RANDOM.TURNO ;
END;
GO

IF OBJECT_ID('T_RESULTADO') IS NOT NULL
BEGIN
DROP index T_RESULTADO ON RANDOM.TURNO ;
END;
GO

IF OBJECT_ID('C_TIPO_CANCELACION') IS NOT NULL
BEGIN
DROP index C_TIPO_CANCELACION ON RANDOM.CANCELACION ;
END;
GO

IF OBJECT_ID('C_TURNO') IS NOT NULL
BEGIN
DROP index C_TURNO ON RANDOM.CANCELACION ;
END;
GO

IF OBJECT_ID('P_USERNAME') IS NOT NULL
BEGIN
DROP index P_USERNAME ON RANDOM.PERSONA ;
END;
GO

-- DROP SCHEMA

IF  EXISTS (SELECT * FROM sys.schemas WHERE name = N'RANDOM')
DROP SCHEMA [RANDOM]
GO

-- CREATE SCHEMA

CREATE SCHEMA [RANDOM] AUTHORIZATION [dbo]
GO

-- CREATE TABLAS
CREATE TABLE RANDOM.ROL(
	IdRol int PRIMARY KEY IDENTITY(1,1),
	Estado bit DEFAULT 1, -- 1 activo
	Descripcion nvarchar(255) UNIQUE
	)

CREATE TABLE RANDOM.FUNCIONALIDADES(
	IdFuncionalidad int PRIMARY KEY IDENTITY (1,1),
	DescripcionFunc nvarchar(255) UNIQUE
)

CREATE TABLE RANDOM.ROL_POR_FUNCIONALIDADES(
	IdFuncionalidad int,
	IdRol int 
	)

CREATE TABLE RANDOM.USUARIO(
	IdUsuario int PRIMARY KEY IDENTITY(1,1),
	Username nvarchar(255) NOT NULL UNIQUE,
	Pass nvarchar(255) NOT NULL,
	FechaCreacion datetime,
	UltimaModificacion datetime,
	IntentosFallidos int NOT NULL DEFAULT 0,
	Estado bit NOT NULL DEFAULT 1
)
CREATE TABLE RANDOM.USUARIO_POR_ROL(
	IdUsuario int,
	IdRol int
)

CREATE TABLE RANDOM.PERSONA(
	IdPersona int PRIMARY KEY IDENTITY(1,1),
	Nombre nvarchar(255),
	Apellido nvarchar(255),
	--IdUsuario int, tengo la sospecha de que no ca, analizar. en los del otro cuatri no tenian realizacion
	--TipoDocumento nvarchar(255), son todos dni, habria que dejarlo seteado?
	Dni numeric(18, 0),
	Direccion nvarchar(255),
	Telefono numeric(18, 0),
	Mail nvarchar(255),
	Fecha_Nac datetime,
	Sexo nvarchar(255),
	Baja bit DEFAULT 0,
)

CREATE TABLE RANDOM.AFILIADO(
	IdPersona int PRIMARY KEY,
	IdEstadoCivil int,
	CantidadACargo int,
	IdPlan int,
	--IdFamiliar,
	NumeroAfiliado int,
	--Estado nvarchar(255), que era esto?
	NumeroUltimoBono int
)

CREATE TABLE RANDOM.PLANES(
	IdPlan int PRIMARY KEY IDENTITY(1,1),
	Codigo numeric(18),
	Nombre nvarchar(255),
	Abono int, 
	MontoConsulta numeric(18),
	MontoExpendio numeric(18)
)

CREATE TABLE RANDOM.HISTORIAL_PLAN(
	IdHistorialPlan int PRIMARY KEY IDENTITY(1,1),
	IdAfiliado int,
	Motivo nvarchar(255),
	Fecha datetime,
	PlanElegido nvarchar(255)
)

CREATE TABLE.RANDOM.ESTADO_CIVIL(
	IdEstadoCivil int PRIMARY KEY IDENTITY (1,1),
	Descripcion nvarchar(255)
)

CREATE TABLE RANDOM.PROFESIONAL(
	IdProfesional int PRIMARY KEY IDENTITY (1,1),
	IdPersona int,
	Matricula int
)
CREATE TABLE RANDOM.TIPO_ESPECIALIDAD(
	IdTipoEspecialidad int PRIMARY KEY IDENTITY(1,1),
	Codigo numeric(18),
	Descripcion nvarchar(255)
)

CREATE TABLE RANDOM.ESPECIALIDAD(
	IdEspecialidad int PRIMARY KEY IDENTITY(1,1),
	Codigo numeric(18),
	Descripcion nvarchar(255),
	IdTipoEspecialidad int
)

CREATE TABLE RANDOM.ESPECIALIDAD_POR_PROFESIONAL(
	IdProfesional int,
	IdEspecialidad int
)

CREATE TABLE RANDOM.COMPRA_BONO(
	IdCompra int PRIMARY KEY IDENTITY (1,1),
	IdAfiliado int,
	Fecha datetime,
	MontoTotal int
)

CREATE TABLE RANDOM.BONO(
	IdBono int PRIMARY KEY IDENTITY(1,1),
	IdCompra int,
	Estado nvarchar(255),
	Precio int,
	FechaConsultaImpresion datetime,
	ConsultaNumero numeric(18)
)

CREATE TABLE RANDOM.DIA(
	IdDia int PRIMARY KEY IDENTITY (1,1),
	Dia nvarchar(255)
)

CREATE TABLE RANDOM.AGENDA_HORARIO_DISPONIBLE(
	IdAgenda int PRIMARY KEY IDENTITY (1,1),
	IdProfesional int,
	IdDia int,
	Hora datetime,
	IdEspecialidad int,
	EstadoDisponibilidad nvarchar(255)
)
--TURNO NUMERO, TURNO FECHA AGENDA O TURNO? EN LA MAESTRA ESTA

CREATE TABLE RANDOM.TURNO(
	IdTurno int PRIMARY KEY IDENTITY(1,1),
	IdAgenda int,
	Estado nvarchar(255),
	IdBono int,
	IdResultado int
)

CREATE TABLE RANDOM.RESULTADO_TURNO(
	IdResultadoTurno int PRIMARY KEY IDENTITY(1,1),
	Sintomas nvarchar(255),
	Enfermedades nvarchar(255),
	Fecha datetime
)

CREATE TABLE RANDOM.CANCELACION(
	IdCancelacion int PRIMARY KEY IDENTITY(1,1),
	IdTipoCancelacion int,
	IdTurno int
)

CREATE TABLE RANDOM.TIPO_CANCELACION(
	IdTipoCancelacion int PRIMARY KEY IDENTITY(1,1),
	Descripcion nvarchar(255)
)
--FOREIGN KEY 

--ALTER TABLE RANDOM.PERSONA ADD FOREIGN KEY (IdUsuario) REFERENCES RANDOM.USUARIO
ALTER TABLE RANDOM.ROL_POR_FUNCIONALIDADES ADD FOREIGN KEY (IdFuncionalidad) REFERENCES RANDOM.FUNCIONALIDADES
ALTER TABLE RANDOM.ROL_POR_FUNCIONALIDADES ADD FOREIGN KEY (IdRol) REFERENCES RANDOM.ROL
ALTER TABLE RANDOM.USUARIO_POR_ROL ADD FOREIGN KEY (IdUsuario) REFERENCES RANDOM.USUARIO
ALTER TABLE RANDOM.USUARIO_POR_ROL ADD FOREIGN KEY (IdRol) REFERENCES RANDOM.ROL
ALTER TABLE RANDOM.AFILIADO ADD FOREIGN KEY (IdPersona) REFERENCES RANDOM.PERSONA
ALTER TABLE RANDOM.AFILIADO ADD FOREIGN KEY (IdEstadoCivil) REFERENCES RANDOM.ESTADO_CIVIL
ALTER TABLE RANDOM.AFILIADO ADD FOREIGN KEY (IdPlan) REFERENCES RANDOM.PLANES
ALTER TABLE RANDOM.HISTORIAL_PLAN ADD FOREIGN KEY (IdAfiliado) REFERENCES RANDOM.AFILIADO
ALTER TABLE RANDOM.PROFESIONAL ADD FOREIGN KEY (IdPersona) REFERENCES RANDOM.PERSONA
ALTER TABLE RANDOM.ESPECIALIDAD ADD FOREIGN KEY (IdTipoEspecialidad) REFERENCES RANDOM.TIPO_ESPECIALIDAD
ALTER TABLE RANDOM.ESPECIALIDAD_POR_PROFESIONAL ADD FOREIGN KEY (IdProfesional) REFERENCES RANDOM.PROFESIONAL
ALTER TABLE RANDOM.ESPECIALIDAD_POR_PROFESIONAL ADD FOREIGN KEY (IdEspecialidad) REFERENCES RANDOM.ESPECIALIDAD
ALTER TABLE RANDOM.COMPRA_BONO ADD FOREIGN KEY (IdAfiliado) REFERENCES RANDOM.AFILIADO
ALTER TABLE RANDOM.BONO ADD FOREIGN KEY (IdCompra) REFERENCES RANDOM.COMPRA_BONO
ALTER TABLE RANDOM.AGENDA_HORARIO_DISPONIBLE ADD FOREIGN KEY (IdProfesional) REFERENCES RANDOM.PROFESIONAL
ALTER TABLE RANDOM.AGENDA_HORARIO_DISPONIBLE ADD FOREIGN KEY (IdDia) REFERENCES RANDOM.DIA
ALTER TABLE RANDOM.AGENDA_HORARIO_DISPONIBLE ADD FOREIGN KEY (IdEspecialidad) REFERENCES RANDOM.ESPECIALIDAD
ALTER TABLE RANDOM.TURNO ADD FOREIGN KEY (IdAgenda) REFERENCES RANDOM.AGENDA_HORARIO_DISPONIBLE
ALTER TABLE RANDOM.TURNO ADD FOREIGN KEY (IdBono) REFERENCES RANDOM.BONO
ALTER TABLE RANDOM.TURNO ADD FOREIGN KEY (IdResultado) REFERENCES RANDOM.RESULTADO_TURNO
ALTER TABLE RANDOM.CANCELACION ADD FOREIGN KEY (IdTipoCancelacion) REFERENCES RANDOM.TIPO_CANCELACION
ALTER TABLE RANDOM.CANCELACION ADD FOREIGN KEY (IdTurno) REFERENCES RANDOM.TURNO

-- CREATE INDIXES

/*IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'P_USERNAME' AND object_id = OBJECT_ID('RANDOM.PERSONA'))
BEGIN
CREATE INDEX P_USERNAME ON RANDOM.PERSONA (IdUsuario);
END*/

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'A_FUNCIONALIDAD' AND object_id = OBJECT_ID('RANDOM.ROL_POR_FUNCIONALIDADES'))
BEGIN
CREATE INDEX A_FUNCIONALIDAD ON RANDOM.ROL_POR_FUNCIONALIDADES (IdFuncionalidad);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'A_ROL' AND object_id = OBJECT_ID('RANDOM.ROL_POR_FUNCIONALIDADES'))
BEGIN
CREATE INDEX A_ROL ON RANDOM.ROL_POR_FUNCIONALIDADES (IdRol);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'UPR_USUARIO' AND object_id = OBJECT_ID('RANDOM.USUARIO_POR_ROL'))
BEGIN
CREATE INDEX UPR_USUARIO ON RANDOM.USUARIO_POR_ROL (IdUsuario);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'UPR_ROL' AND object_id = OBJECT_ID('RANDOM.USUARIO_POR_ROL'))
BEGIN
CREATE INDEX UPR_ROL ON RANDOM.USUARIO_POR_ROL (IdRol);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'A_PERSONA' AND object_id = OBJECT_ID('RANDOM.AFILIADO'))
BEGIN
CREATE INDEX A_PERSONA ON RANDOM.AFILIADO (IdPersona);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'A_ESTADO_CIVIL' AND object_id = OBJECT_ID('RANDOM.AFILIADO'))
BEGIN
CREATE INDEX A_ESTADO_CIVIL ON RANDOM.AFILIADO (IdEstadoCivil);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'A_PLAN' AND object_id = OBJECT_ID('RANDOM.AFILIADO'))
BEGIN
CREATE INDEX A_PLAN ON RANDOM.AFILIADO (IdPlan);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'HA_ID_AFILIADO' AND object_id = OBJECT_ID('RANDOM.HISTORIAL_PLAN'))
BEGIN
CREATE INDEX HA_ID_AFILIADO ON RANDOM.HISTORIAL_PLAN (IdAfiliado);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'P_PERSONA' AND object_id = OBJECT_ID('RANDOM.PROFESIONAL'))
BEGIN
CREATE INDEX P_PERSONA ON RANDOM.PROFESIONAL (IdPersona);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'E_TIPO_ESPECIALIDAD' AND object_id = OBJECT_ID('RANDOM.ESPECIALIDAD'))
BEGIN
CREATE INDEX E_TIPO_ESPECIALIDAD ON RANDOM.ESPECIALIDAD (IdTipoEspecialidad);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'EPP_PROFESIONAL' AND object_id = OBJECT_ID('RANDOM.ESPECIALIDAD_POR_PROFESIONAL'))
BEGIN
CREATE INDEX EPP_PROFESIONAL ON RANDOM.ESPECIALIDAD_POR_PROFESIONAL (IdProfesional);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'EPP_ESPECIALIDAD' AND object_id = OBJECT_ID('RANDOM.ESPECIALIDAD_POR_PROFESIONAL'))
BEGIN
CREATE INDEX EPP_ESPECIALIDAD ON RANDOM.ESPECIALIDAD_POR_PROFESIONAL (IdEspecialidad);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'CB_AFILIADO' AND object_id = OBJECT_ID('RANDOM.COMPRA_BONO'))
BEGIN
CREATE INDEX CB_AFILIADO ON RANDOM.COMPRA_BONO (IdAfiliado);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'B_COMPRA' AND object_id = OBJECT_ID('RANDOM.BONO'))
BEGIN
CREATE INDEX B_COMPRA ON RANDOM.BONO (IdCompra);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'HD_PROFESIONAL' AND object_id = OBJECT_ID('RANDOM.AGENDA_HORARIO_DISPONIBLE'))
BEGIN
CREATE INDEX HD_PROFESIONAL ON RANDOM.AGENDA_HORARIO_DISPONIBLE (IdProfesional);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'HD_DIA' AND object_id = OBJECT_ID('RANDOM.AGENDA_HORARIO_DISPONIBLE'))
BEGIN
CREATE INDEX HD_DIA ON RANDOM.AGENDA_HORARIO_DISPONIBLE (IdDia);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'HD_ESPECIALIDAD' AND object_id = OBJECT_ID('RANDOM.AGENDA_HORARIO_DISPONIBLE'))
BEGIN
CREATE INDEX HD_ESPECIALIDAD ON RANDOM.AGENDA_HORARIO_DISPONIBLE (IdEspecialidad);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'T_AGENDA' AND object_id = OBJECT_ID('RANDOM.TURNO'))
BEGIN
CREATE INDEX T_AGENDA ON RANDOM.TURNO (IdAgenda);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'T_BONO' AND object_id = OBJECT_ID('RANDOM.TURNO'))
BEGIN
CREATE INDEX T_BONO ON RANDOM.TURNO (IdBono);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'T_RESULTADO' AND object_id = OBJECT_ID('RANDOM.TURNO'))
BEGIN
CREATE INDEX T_RESULTADO ON RANDOM.TURNO (IdResultado);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'C_TIPO_CANCELACION' AND object_id = OBJECT_ID('RANDOM.CANCELACION'))
BEGIN
CREATE INDEX C_TIPO_CANCELACION ON RANDOM.CANCELACION (IdTipoCancelacion);
END

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'C_TURNO' AND object_id = OBJECT_ID('RANDOM.CANCELACION'))
BEGIN
CREATE INDEX C_TURNO ON RANDOM.CANCELACION (IdTurno);
END


------------------------  MIGRACION  ------------------------------

/*ROL*/
INSERT INTO RANDOM.ROL(Descripcion)
VALUES ('Administrador')
INSERT INTO RANDOM.ROL(Descripcion)
VALUES ('Afiliado')
INSERT INTO RANDOM.ROL(Descripcion)
VALUES ('Profesional')

/*FUNCIONALIDADES*/
SET IDENTITY_INSERT RANDOM.FUNCIONALIDADES ON
INSERT INTO RANDOM.FUNCIONALIDADES(IdFuncionalidad,DescripcionFunc)
VALUES (0,'Alta Afiliado')
INSERT INTO RANDOM.FUNCIONALIDADES(IdFuncionalidad,DescripcionFunc)
VALUES (1,'Modificar Afiliado')
INSERT INTO RANDOM.FUNCIONALIDADES(IdFuncionalidad,DescripcionFunc)
VALUES (2,'Baja Afiliado')
INSERT INTO RANDOM.FUNCIONALIDADES(IdFuncionalidad,DescripcionFunc)
VALUES (3,'Alta Profesional')
INSERT INTO RANDOM.FUNCIONALIDADES(IdFuncionalidad,DescripcionFunc)
VALUES (4,'Modificar Profesional')
INSERT INTO RANDOM.FUNCIONALIDADES(IdFuncionalidad,DescripcionFunc)
VALUES (5,'Baja Profesional')
INSERT INTO RANDOM.FUNCIONALIDADES(IdFuncionalidad,DescripcionFunc)
VALUES (6,'Generar Agenda')
INSERT INTO RANDOM.FUNCIONALIDADES(IdFuncionalidad,DescripcionFunc)
VALUES (7,'Comprar Bono')
INSERT INTO RANDOM.FUNCIONALIDADES(IdFuncionalidad,DescripcionFunc)
VALUES (8,'Registrar Llegada a la Atención')
INSERT INTO RANDOM.FUNCIONALIDADES(IdFuncionalidad,DescripcionFunc)
VALUES (9,'Solicitar Turno')
INSERT INTO RANDOM.FUNCIONALIDADES(IdFuncionalidad,DescripcionFunc)
VALUES (10,'Cancelar Turno')
INSERT INTO RANDOM.FUNCIONALIDADES(IdFuncionalidad,DescripcionFunc)
VALUES (11,'Registrar Diagnóstico')
INSERT INTO RANDOM.FUNCIONALIDADES(IdFuncionalidad,DescripcionFunc)
VALUES (12,'Consulta TOP 5')
SET IDENTITY_INSERT RANDOM.FUNCIONALIDADES OFF

/*ROL_POR_FUNCIONALIDADES*/
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(0,1)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(1,1)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(2,1)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(3,1)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(4,1)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(5,1)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(6,3)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(7,1)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(7,2)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(8,1)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(9,2)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(10,2)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(10,3)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(11,3)
INSERT INTO RANDOM.ROL_POR_FUNCIONALIDADES
VALUES(12,2)

/*USUARIO*/
INSERT INTO RANDOM.USUARIO(Username,Pass)
VALUES('admin','e6b87050bfcb8143fcb8db0170a4dc9ed00d904ddd3e2a4ad1b1e8dc0fdc9be7')
INSERT INTO RANDOM.USUARIO(Username,Pass)
VALUES('ana','e6b87050bfcb8143fcb8db0170a4dc9ed00d904ddd3e2a4ad1b1e8dc0fdc9be7')
INSERT INTO RANDOM.USUARIO(Username,Pass)
VALUES('maria','e6b87050bfcb8143fcb8db0170a4dc9ed00d904ddd3e2a4ad1b1e8dc0fdc9be7')
INSERT INTO RANDOM.USUARIO(Username,Pass)
VALUES('jose','e6b87050bfcb8143fcb8db0170a4dc9ed00d904ddd3e2a4ad1b1e8dc0fdc9be7')
INSERT INTO RANDOM.USUARIO(Username,Pass)
VALUES('pepe','e6b87050bfcb8143fcb8db0170a4dc9ed00d904ddd3e2a4ad1b1e8dc0fdc9be7')
	
/*USUARIO_POR_ROL*/
INSERT INTO RANDOM.USUARIO_POR_ROL(IdUsuario,IdRol)
SELECT U.IdUsuario, 1
FROM RANDOM.USUARIO U, RANDOM.ROL R
WHERE R.Descripcion = 'Administrador'

/*PERSONA*/ -- agregamos los afiliados nada mas aca
INSERT INTO RANDOM.PERSONA(Nombre, Apellido, Dni, Direccion, Telefono, Mail, Fecha_Nac) 
SELECT DISTINCT M.Paciente_Nombre, M.Paciente_Apellido, M.Paciente_Dni, M.Paciente_Direccion, M.Paciente_Telefono, M.Paciente_Mail, M.Paciente_Fecha_Nac
FROM gd_esquema.Maestra M

/*PERSONA*/ -- agregamos los meedicos nada mas aca
INSERT INTO RANDOM.PERSONA(Nombre, Apellido, Dni, Direccion, Telefono, Mail, Fecha_Nac) 
SELECT DISTINCT M.Medico_Nombre, M.Medico_Apellido, M.Medico_Dni, M.Medico_Direccion, M.Medico_Telefono, M.Medico_Mail, M.Medico_Fecha_Nac
FROM gd_esquema.Maestra M

/*PLANES*/
INSERT INTO RANDOM.PLANES(Codigo,Nombre, MontoConsulta, MontoExpendio)
SELECT DISTINCT M.Plan_Med_Codigo, M.Plan_Med_Descripcion, M.Plan_Med_Precio_Bono_Consulta, M.Plan_Med_Precio_Bono_Farmacia
FROM gd_esquema.Maestra M

/*Bonos de los planes seteo*/
UPDATE RANDOM.PLANES
SET Abono = 150
WHERE IdPlan = 1;
UPDATE RANDOM.PLANES
SET Abono = 110
WHERE IdPlan = 2;
UPDATE RANDOM.PLANES
SET Abono = 130
WHERE IdPlan = 3;
UPDATE RANDOM.PLANES
SET Abono = 120
WHERE IdPlan = 4;
UPDATE RANDOM.PLANES
SET Abono = 140
WHERE IdPlan = 5;

/*AFILIADO*/
INSERT INTO RANDOM.AFILIADO(IdPersona, IdPlan)
SELECT DISTINCT P.IdPersona, PL.IdPlan
FROM gd_esquema.Maestra M
JOIN RANDOM.PERSONA P ON M.Paciente_Nombre = P.Nombre AND M.Paciente_Apellido = P.Apellido AND M.Paciente_Dni = P.Dni
JOIN RANDOM.PLANES PL ON M.Plan_Med_Codigo = PL.Codigo

/*TIPO_ESPECIALIDAD*/
INSERT INTO RANDOM.TIPO_ESPECIALIDAD(Codigo,Descripcion)
SELECT DISTINCT M.Tipo_Especialidad_Codigo, M.Tipo_Especialidad_Descripcion
FROM gd_esquema.Maestra M

/*ESPECIALIDAD*/
INSERT INTO RANDOM.ESPECIALIDAD(Codigo,Descripcion, IdTipoEspecialidad)
SELECT DISTINCT M.Especialidad_Codigo, M.Especialidad_Descripcion, E.IdTipoEspecialidad
FROM gd_esquema.Maestra M
JOIN RANDOM.TIPO_ESPECIALIDAD E ON M.Tipo_Especialidad_Codigo = E.Codigo 

/*PROFESIONAL*/
INSERT INTO RANDOM.PROFESIONAL(IdPersona, Matricula)
SELECT DISTINCT P.IdPersona, M.Especialidad_Codigo
FROM gd_esquema.Maestra M
JOIN RANDOM.PERSONA P ON M.Medico_Nombre =P.Nombre AND M.Medico_Apellido = P.Apellido AND M.Medico_Dni = P.Dni